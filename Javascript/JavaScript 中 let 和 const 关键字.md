# JavaScript 中 `let` 和 `const` 关键字详解

ES6（ECMAScript 2015）新增了 `let` 和 `const` 两个关键字，用于声明变量，解决了传统 `var` 关键字在作用域、变量提升等方面的缺陷。本文对比三者的特性，详细说明 `let` 和 `const` 的用法与注意事项。

## 一、作用域差异（核心区别）

### 1. `var` 的作用域

- **全局作用域**：函数外声明的 `var` 变量，在程序任何地方可访问（浏览器中属于 `window` 对象）。

- **函数作用域**：函数内声明的 `var` 变量，仅在函数内有效。

- **无块级作用域**：`{}` 代码块无法限制 `var` 变量的作用域，块外仍可访问。

  ```javascript
  {
    var x = 10;
  }
  console.log(x); // 输出 10（块外可访问）
  ```

### 2. `let` 的作用域

- **块级作用域**：`let` 声明的变量仅在所在代码块（`{}`）内有效，块外不可访问。

- **函数作用域**：函数内声明的 `let` 变量，作用域为局部（与 `var` 类似）。

- **全局作用域**：函数外声明的 `let` 变量为全局变量，但**不属于 `window` 对象**（与 `var` 不同）。

  ```javascript
  {
    let x = 10;
  }
  console.log(x); // 报错（x 未定义，块外不可访问）
  ```

### 3. `const` 的作用域

- 与 `let` 完全一致，具有**块级作用域**、函数作用域和全局作用域，且全局变量不属于 `window` 对象。

  ```javascript
  {
    const PI = 3.14;
    console.log(PI); // 输出 3.14（块内有效）
  }
  console.log(PI); // 报错（PI 未定义，块外不可访问）
  ```

## 二、变量声明与修改规则

### 1. `var` 的特性

- 可重复声明：同一作用域内可重复声明同一变量，后声明的会覆盖前者。

  ```javascript
  var x = 10;
  var x = 20; // 合法，x 被覆盖为 20
  ```

- 可修改值：任何时候都能修改变量的值。

  ```javascript
  var x = 10;
  x = 20; // 合法，x 变为 20
  ```

### 2. `let` 的特性

- 不可重复声明：同一作用域或块级作用域内，`let`变量不能重复声明（包括与`var`重复）。

  ```javascript
  let x = 10;
  let x = 20; // 报错（重复声明）
  
  var y = 10;
  let y = 20; // 报错（与 var 重复）
  ```

- 可修改值：声明后可修改变量的值。

  ```javascript
  let x = 10;
  x = 20; // 合法，x 变为 20
  ```

- 不同作用域可重名：不同块级作用域内，`let`变量可重名。

  ```javascript
  let x = 10;
  {
    let x = 20; // 合法，块级作用域内重名
  }
  ```

### 3. `const` 的特性

- 必须初始化：声明时必须赋值，否则报错。

  ```javascript
  const PI; // 报错（未初始化）
  const PI = 3.14; // 合法
  ```

- 不可修改引用：基本类型（数字、字符串等）的值不可修改；引用类型（对象、数组）的引用地址不可修改，但内容可改。

  ```javascript
  // 基本类型：不可修改
  const PI = 3.14;
  PI = 3.1415; // 报错（修改值）
  
  // 引用类型：内容可改，引用不可改
  const car = { color: "red" };
  car.color = "blue"; // 合法（修改对象属性）
  car = { color: "green" }; // 报错（修改引用地址）
  ```

- 不可重复声明：同一作用域内，`const`变量不能重复声明（包括与`var`、`let`重复）。

  ```javascript
  const x = 10;
  const x = 20; // 报错（重复声明）
  
  let y = 10;
  const y = 20; // 报错（与 let 重复）
  ```

- 不同作用域可重名

  ：不同块级作用域内，`const`变量可重名。

  ```javascript
  const x = 10;
  {
    const x = 20; // 合法
  }
  ```

## 三、变量提升差异

- **`var` 存在变量提升**：可先使用变量，后声明（声明被提升到作用域顶部）。

  ```javascript
  console.log(x); // 输出 undefined（不报错）
  var x = 10;
  ```

- **`let` 和 `const` 无变量提升**：必须先声明，后使用，否则报错（暂时性死区）。

  ```javascript
  console.log(x); // 报错（x 未声明）
  let x = 10;
  
  console.log(PI); // 报错（PI 未声明）
  const PI = 3.14;
  ```

## 四、全局变量与 `window` 对象的关系

- **`var` 声明的全局变量**：属于 `window` 对象，可通过 `window.变量名` 访问。

  ```javascript
  var carName = "Volvo";
  console.log(window.carName); // 输出 "Volvo"
  ```

- **`let` 和 `const` 声明的全局变量**：不属于 `window` 对象，无法通过 `window.变量名` 访问。

  ```javascript
  let carName = "Volvo";
  console.log(window.carName); // 输出 undefined
  ```

## 五、`var`、`let`、`const` 对比表

| 特性                | `var`             | `let`            | `const`          |
| ------------------- | ----------------- | ---------------- | ---------------- |
| 作用域              | 全局 / 函数作用域 | 块级作用域       | 块级作用域       |
| 重复声明            | 允许              | 不允许           | 不允许           |
| 初始化要求          | 可选              | 可选             | 必须             |
| 变量提升            | 有                | 无（暂时性死区） | 无（暂时性死区） |
| 全局变量属 `window` | 是                | 否               | 否               |
| 基本类型值可改      | 是                | 是               | 否               |
| 引用类型引用可改    | 是                | 是               | 否（内容可改）   |

## 六、使用建议

1. **优先使用 `const`**：声明不修改的变量（如配置项、常量），避免意外修改。
2. **其次使用 `let`**：声明需要修改的变量（如循环计数器、临时变量）。
3. **避免使用 `var`**：其无块级作用域和变量提升特性易导致 bugs（如循环变量泄露）。

通过合理使用 `let` 和 `const`，可使代码更严谨、易维护，减少作用域相关的错误。